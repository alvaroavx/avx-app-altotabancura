 $.IsAdminUp = function() { var admin = $('#adminrow'); var ret; if(admin.css('display')==="flex") ret = true; else ret = false; return ret;};$.SidebarFocus = function(seccion) { if(!$.IsAdminUp()) { $.LoadAdmin("focus", seccion); } else { $('.admincol').removeClass("active"); if(seccion==="universidad") $('#universidadesrow').addClass("active"); else if (seccion==="sede") $('#sedesrow').addClass("active"); else if(seccion==="carrera") $('#carrerasrow').addClass("active"); else if(seccion==="vacuna") $('#vacunasrow').addClass("active"); else if(seccion==="docente") $('#docentesrow').addClass("active"); }};$.SidebarNew = function (seccion) { if(!$.IsAdminUp()) { $.LoadAdmin("new", seccion); } else { if(seccion==="universidad") $.LoadUniversidadForm(); else if(seccion==="sede") $.LoadSedeForm(); else if(seccion==="carrera") $.LoadCarreraForm(); else if(seccion==="vacuna") $.LoadVacunaForm(); }};$.AddAlumno = function () { if(!$.IsAdminUp()) { $.LoadAdmin("focus", "alumno"); } else { $.LoadAlumnoForm(); }};$.EditAlumno = function () { $.LoadResultados(); $('#adminbutton').click();};$.AddDocente = function () { if(!$.IsAdminUp()) { $.LoadAdmin("focus", "docente"); } else { $.LoadDocenteForm(); }};$.EditDocente = function () { console.log('MOSTRAR DOCENTES');};$.ShowSidebar = function () { var sidebar = $("#sidebar"); if(sidebar.css("display")==="block") { sidebar.css("display","none") } else { sidebar.css("display","block") }}; $.VistaAdmin = function(){ $.FootPrint('administracion'); $.ajax({ data: $.RawData("VistaAdmin"), success: function (response) { $("#midblock").html(response); }, complete: function(){ } });}; $.LoadAdmin = function(action=null, seccion=null){ $.FootPrint('administracion'); $.ajax({ data: $.RawData("LoadAdmin"), success: function (response) { $("#resultsrow").html(response); }, complete: function(){ if(action==="new") { if (seccion === "universidad") $.LoadUniversidadForm(); else if (seccion === "sede") $.LoadSedeForm(); else if (seccion === "carrera") $.LoadCarreraForm(); else if (seccion === "vacuna") $.LoadVacunaForm(); } else if (action==="focus") { if(seccion==="universidad") $('#universidadesrow').addClass("active"); else if (seccion==="sede") $('#sedesrow').addClass("active"); else if(seccion==="carrera") $('#carrerasrow').addClass("active"); else if(seccion==="vacuna") $('#vacunasrow').addClass("active"); else if(seccion==="alumno") $.LoadAlumnoForm(); else if(seccion==="docente") $.LoadDocenteForm(); } } });}; $.EditThis = function(elem) { var tr = $(elem).closest("tr"); if(tr.find(".view").hasClass("hidden")) { tr.find(".view").removeClass("hidden"); tr.find(".rework").addClass("hidden"); } else { tr.find(".view").addClass("hidden"); tr.find(".rework").removeClass("hidden"); tr.find('input').focus(); }}; $.LoadSelectCarrera = function() { $.ajax({ data: $.RawData("LoadSelectCarrera"), success: function (response) { $("#carreras").html(response); }, complete: function(){} });}; $.LoadCarreraAdmin = function(){ $.ajax({ data: $.RawData("LoadCarreraAdmin"), success: function (response) { $("#carr_admin").html(response); }, complete: function(){ $('#carrerastable').DataTable({ paging: true, "oLanguage": { "sProcessing": "Procesando...", "sLengthMenu": "Mostrar _MENU_ registros", "sSearch": "Filtrar Carrera:", "sInfo": "Mostrando _TOTAL_ carreras", "sInfoEmpty": "Mostrando 0 carreras", "sZeroRecords": "No se encontraron resultados", "sInfoFiltered": "(filtrado de un total de _MAX_)", "oPaginate": { "sFirst": "Primero", "sLast": "Ultimo", "sNext": "Siguiente", "sPrevious": "Anterior" }, } }); } });}; $.LoadCarreraForm = function() { var formulario = $("#carreraform"); if(formulario.hasClass("open")) { formulario.empty(); formulario.removeClass("open"); } else { $.ajax({ data: $.RawData("LoadCarreraForm"), success: function (response) { formulario.html(response); formulario.addClass("open"); }, complete: function () { formulario.find('input').focus(); } }); }};$.SaveCarrera = function(formId) { var form = $('#'+formId); var carrera = []; if($("#carreraform").hasClass("open")) $.LoadCarreraForm(); $.each(form.serializeArray(), function(i, field) { var input = $('input[name='+field.name+']'); field.value = $.trim(field.value); switch(field.name){ case "idcarrera": carrera["idcarrera"] = field.value; break; case "nombre": carrera["nombre"] = field.value; break; default: console.log("default: "+field.value); break; } }); $.ajax({ data: $.RawData('CreateModifyCarrera', { 'IdCarrera': carrera["idcarrera"], 'Nombre': carrera["nombre"] }), success: function () { $.LoadCarreraAdmin(); }, complete: function(){} });};$.DeleteCarrera = function(idCarrera) { $.ajax({ data: $.RawData('RemoveCarrera', { 'IdCarrera': idCarrera }), success: function () { $.LoadCarreraAdmin(); }, complete: function(){} });}; $.LoadCore = function(){ $.LoadMidBlock(0); $.LoadModal(0);};$.LoadMidBlock = function(init){ var constructor = $("#constructor"); var midblock = $("#midblock"); init = $.IsNull(init,0); $.ajax({ data: $.RawData("LoadMidBlock", { "load": constructor.attr("data-load"), "idload": constructor.attr("data-idload"), "init": init }), beforeSend: function(){ midblock.addClass("loading"); }, success: function (response){ midblock.html(response); }, complete: function(){ midblock.removeClass("loading"); } });};$.LoadHeader = function(init){ $.ajax({ data: $.RawData("LoadHeader", { "init": init }), success: function (response) { $("header").html(response); } });};$.LoadFooter = function(init){ $.ajax({ data: $.RawData("LoadFooter", { "init": init }), success: function (response) { $("footer").html(response); } });};$.LifeNote = function(tipo, valor){ }; $.LoadDashboard = function(){ $.FootPrint('repositorio'); $.ajax({ data: $.RawData("LoadDashboard"), success: function (response) { $("#midblock").html(response); }, complete: function(){ $.GoUp($("#midblock"), 0); } });}; $.LoadMenu = function(){ $.ajax({ data: $.RawData("LoadMenu"), success: function (response) { $("#topbar").html(response); }, complete: function(){ $.GoUp($("#midblock"), 0); } });}; $.ToggleSeccion = function(elem, seccion) { var contenido = $('#contenido_'+seccion); var icon = $(elem).children(); if(contenido.css('display') === 'none') { contenido.css('display', 'block'); icon.removeClass('right-caret'); icon.addClass('down-caret'); } else { contenido.css('display', 'none'); icon.removeClass('down-caret'); icon.addClass('right-caret'); }}; $.LoadSelectSede = function() { $.ajax({ data: $.RawData("LoadSelectSede"), success: function (response) { $("#sedes").html(response); }, complete: function(){} });}; $.LoadSedeAdmin = function(){ $.ajax({ data: $.RawData("LoadSedeAdmin"), success: function (response) { $("#sede_admin").html(response); }, complete: function(){ $('#sedetable').DataTable({ paging: true, "oLanguage": { "sProcessing": "Procesando...", "sLengthMenu": "Mostrar _MENU_ registros", "sSearch": "Filtrar Sede:", "sInfo": "Mostrando _TOTAL_ sedes", "sInfoEmpty": "Mostrando 0 sedes", "sZeroRecords": "No se encontraron resultados", "sInfoFiltered": "(filtrado de un total de _MAX_)", "oPaginate": { "sFirst": "Primero", "sLast": "Ultimo", "sNext": "Siguiente", "sPrevious": "Anterior" }, } }); } });}; $.LoadSedeForm = function() { var formulario = $("#sedeform"); if(formulario.hasClass("open")) { formulario.empty(); formulario.removeClass("open"); } else { $.ajax({ data: $.RawData("LoadSedeForm"), success: function (response) { formulario.html(response); formulario.addClass("open"); }, complete: function () { formulario.find('select').focus(); } }); }};$.SaveSede = function(elem) { var form = $(elem).closest('.formulario'); var sede = []; var empty = false; sede["idsede"] = form.find('input[name=idsede]').val(); if(form.find('option:selected').val() === "") { form.find('#universidades').css("border-color", "red"); empty = true; } else { sede["iduniversidad"] = form.find('option:selected').val(); } if(form.find('input[name=nombre]').val() === "") { form.find('input[name=nombre]').css("border-color", "red"); empty = true; } else { sede["nombre"] = form.find('input[name=nombre]').val(); } console.log(sede); if(empty) { } else { if($("#sedeform").hasClass("open")) $.LoadSedeForm(); $.ajax({ data: $.RawData('CreateModifySede', { 'IdSede': sede["idsede"], 'IdUniversidad': sede["iduniversidad"], 'Nombre': sede["nombre"] }), success: function () { $.LoadSedeAdmin(); }, complete: function(){} }); }};$.DeleteSede = function(idSede) { $.ajax({ data: $.RawData('RemoveSede', { 'IdSede': idSede }), success: function () { $.LoadSedeAdmin(); }, complete: function(){} });}; $.LoadSelectUniversidad = function() { $.ajax({ data: $.RawData("LoadSelectUniversidad"), success: function (response) { $("#universidades").html(response); }, complete: function(){} });}; $.LoadUniversidadAdmin = function(){ $.ajax({ data: $.RawData("LoadUniversidadAdmin"), success: function (response) { $("#univ_admin").html(response); }, complete: function(){ $('#universidadtable').DataTable({ paging: true, "oLanguage": { "sProcessing": "Procesando...", "sLengthMenu": "Mostrar _MENU_ registros", "sSearch": "Filtrar Universidad:", "sInfo": "Mostrando _TOTAL_ universidades", "sInfoEmpty": "Mostrando 0 universidades", "sZeroRecords": "No se encontraron resultados", "sInfoFiltered": "(filtrado de un total de _MAX_)", "oPaginate": { "sFirst": "Primero", "sLast": "Ultimo", "sNext": "Siguiente", "sPrevious": "Anterior" }, } }); } });}; $.LoadUniversidadForm = function() { var formulario = $("#universidadform"); if(formulario.hasClass("open")) { formulario.empty(); formulario.removeClass("open"); } else { $.ajax({ data: $.RawData("LoadUniversidadForm"), success: function (response) { formulario.html(response); formulario.addClass("open"); }, complete: function () { formulario.find('input').focus(); } }); }}; $.SaveUniversidad = function(formId) { var form = $('#'+formId); var universidad = []; if($("#universidadform").hasClass("open")) $.LoadUniversidadForm(); $.each(form.serializeArray(), function(i, field) { var input = $('input[name='+field.name+']'); field.value = $.trim(field.value); switch(field.name){ case "iduniversidad": universidad["iduniversidad"] = field.value; break; case "nombre": universidad["nombre"] = field.value; break; default: console.log("default: "+field.value); break; } }); $.ajax({ data: $.RawData('CreateModifyUniversidad', { 'IdUniversidad': universidad["iduniversidad"], 'Nombre': universidad["nombre"] }), success: function () { $.LoadUniversidadAdmin(); $.LoadSedeAdmin(); }, complete: function(){} });}; $.DeleteUniversidad = function(idUniversidad) { $.ajax({ data: $.RawData('RemoveUniversidad', { 'IdUniversidad': idUniversidad }), success: function () { $.LoadUniversidadAdmin(); $.LoadSedeAdmin(); }, complete: function(){} });}; $.VistaAlumno = function(){ $.FootPrint('certificado'); $.ajax({ data: $.RawData("VistaAlumno"), success: function (response) { $("#midblock").html(response); }, complete: function(){} });}; $.VistaDocente = function(){ $.FootPrint('alumnos'); $.ajax({ data: $.RawData("VistaDocente"), success: function (response) { $("#midblock").html(response); }, complete: function(){} });}; $.LoadTopbar = function(){ $.ajax({ data: $.RawData("LoadTopbar"), success: function (response) { $("#topbar").html(response); }, complete: function(){} });}; $.LoadSidebar = function(){ $.ajax({ data: $.RawData("LoadSidebar"), success: function (response) { $("#sidebar").html(response); }, complete: function(){} });}; $.BuscarEnter = function(e) { if (e.key === "Enter") { $.LoadResultadosPaginado(); }}; $.ToggleFiltro = function(elem) { var valores = $(elem).parent().parent().siblings(); var icon = $(elem).children(); if(valores.css('display') === 'none') { valores.css('display', 'block'); icon.removeClass('right-caret'); icon.addClass('down-caret'); } else { valores.css('display', 'none'); icon.removeClass('down-caret'); icon.addClass('right-caret'); }}; $.LoadResultados = function(){ $(".cargando").addClass("up"); $.FootPrint("resultados"); var filtros = []; $(".opcion_filtro.selected").each(function(){ filtros.push({"idtipo": $(this).attr("data-tipo"),"valor": $(this).attr("data-valor")}); }); $.ajax({ data: $.RawData("LoadResultados", { "busqueda" : $.IsNull($("#alumno").val().trim(),""), "filtros" : JSON.stringify(filtros) } ), success: function (response) { $("#resultsrow").html(response); $('#resultstable').DataTable({ "oLanguage": { "sProcessing": "Procesando...", "sLengthMenu": "Mostrar _MENU_ registros", "sZeroRecords": "No se encontraron resultados", "sEmptyTable": "Ningun dato disponible en esta tabla", "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros", "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros", "sInfoFiltered": "(filtrado de un total de _MAX_ registros)", "sInfoPostFix": "", "sSearch": "Buscar:", "sUrl": "", "sInfoThousands": ",", "sLoadingRecords": "Cargando...", "oPaginate": { "sFirst": "Primero", "sLast": "Ultimo", "sNext": "Siguiente", "sPrevious": "Anterior" }, "oAria": { "sSortAscending": ": Activar para ordenar la columna de manera ascendente", "sSortDescending": ": Activar para ordenar la columna de manera descendente" } } }); $.LoadTopbar(); $(".cargando").removeClass("up"); }, complete: function(){} });};$.ActualizaFiltros = function(tipo, valor){ $("#filtros_data div[data-tipo='"+tipo+"']").attr("data-valor", valor); if(tipo === 'universidad' || tipo === 'carrera' || tipo === 'sede' || tipo === 'tamanopagina') $("#filtros_data div[data-tipo='numeropagina']").attr("data-valor", 1); $.LoadResultadosPaginado();}; $.LoadResultadosPaginado = function(){ $(".cargando").addClass("up"); $.FootPrint("resultados2"); $.ajax({ data: $.RawData("LoadResultadosPaginado", { "busqueda" : $.IsNull($("#alumno").val().trim(),""), "iduniversidad" : $.IsNull($("#filtros_data div[data-tipo='universidad']").attr("data-valor"),""), "idsede" : $.IsNull($("#filtros_data div[data-tipo='sede']").attr("data-valor"),""), "idcarrera" : $.IsNull($("#filtros_data div[data-tipo='carrera']").attr("data-valor"),""), "fechavacunadesde" : $.IsNull($("#filtros_data div[data-tipo='fechavacunadesde']").attr("data-valor"),""), "fechavacunahasta" : $.IsNull($("#filtros_data div[data-tipo='fechavacunahasta']").attr("data-valor"),""), "numeropagina" : $.IsNull($("#filtros_data div[data-tipo='numeropagina']").attr("data-valor"), 1), "tamanopagina" : $.IsNull($("#filtros_data div[data-tipo='tamanopagina']").attr("data-valor"), 10), "orderby" : $.IsNull($("#filtros_data div[data-tipo='orderby']").attr("data-valor"),""), } ), success: function (response) { $("#resultsrow").html(response); $('#resultstable').DataTable({ "searching": false, "paging": false, "ordering": false, "oLanguage": { "sProcessing": "Procesando...", "sLengthMenu": "Mostrar _MENU_ registros", "sZeroRecords": "No se encontraron resultados", "sEmptyTable": "Ningun dato disponible en esta tabla", "sInfo": "", "sInfoEmpty": "", "sInfoFiltered": "(filtrado de un total de _MAX_ registros)", "sInfoPostFix": "", "sUrl": "", "sInfoThousands": ",", "sLoadingRecords": "Cargando...", } }); $.LoadTopbar(); $(".cargando").removeClass("up"); }, complete: function(){ $.LoadPaginacion(); } });};$.LoadPaginacion = function(){ $.ajax({ data: $.RawData("LoadPaginacion", { "busqueda" : $.IsNull($("#alumno").val().trim(),""), "iduniversidad" : $.IsNull($("#filtros_data div[data-tipo='universidad']").attr("data-valor"),""), "idsede" : $.IsNull($("#filtros_data div[data-tipo='sede']").attr("data-valor"),""), "idcarrera" : $.IsNull($("#filtros_data div[data-tipo='carrera']").attr("data-valor"),""), "fechavacunadesde" : $.IsNull($("#filtros_data div[data-tipo='fechavacunadesde']").attr("data-valor"),""), "fechavacunahasta" : $.IsNull($("#filtros_data div[data-tipo='fechavacunahasta']").attr("data-valor"),""), "numeropagina" : $.IsNull($("#filtros_data div[data-tipo='numeropagina']").attr("data-valor"), 1), "tamanopagina" : $.IsNull($("#filtros_data div[data-tipo='tamanopagina']").attr("data-valor"), 20), "orderby" : $.IsNull($("#filtros_data div[data-tipo='orderby']").attr("data-valor"),"") }), success: function (response) { $("#paginacion").html(response); }, complete: function(){} });};$.ResultadosPorSede = function (elem, idSede) { if($(elem).hasClass('selected')) { $.CleanFilters(); } else { $(elem).siblings().addClass('hidden'); setTimeout(function () { $.LoadResultadosPaginado(); }, 500); $.ajax({ data: $.RawData("LoadSelectCarreraBySede", {"idSede": idSede} ), success: function (response) { $.ActualizaFiltros('sede', idSede); $("#select_carreras").html(response); }, complete: function () { } }); }};$.ResultadosPorCarrera = function (elem, idCarrera) { if($(elem).hasClass('selected')) { $.CleanFilters(); } else { $(elem).siblings().addClass('hidden'); setTimeout(function () { $.LoadResultadosPaginado(); }, 500); $.ajax({ data: $.RawData("LoadSelectSedeByCarrera", {"idCarrera": idCarrera} ), success: function (response) { $.ActualizaFiltros('carrera', idCarrera); $("#select_sedes").html(response); }, complete: function () { } }); }}; $.CleanFilters = function(){ $('input#alumno').val(''); $('input[type=date]').val(''); $(".opcion_filtro.selected.clearable").removeClass("selected"); $('.opcion_filtro').removeClass('hidden'); $.ajax({ data: $.RawData("LoadFilterData"), success: function (response) { $('#filtros_data').html(response); $.LoadSidebar(); }, complete: function () { } }); }; $.CheckClick = function() { var btn_certificado = $('#certificado_button'); var btn_certificado_tabla = $('#certificado_masivo_button'); var usuarioadmin = $('#centerrow'); var checkboxes = $("input[name='usuario']:checked"); if(checkboxes.length > 0) { btn_certificado.removeClass('hidden'); usuarioadmin.removeClass('hidden'); } else { if(!btn_certificado.hasClass('hidden')) { btn_certificado.addClass('hidden'); usuarioadmin.addClass('hidden'); } } if(checkboxes.length > 5) { btn_certificado_tabla.removeClass('hidden'); } else { btn_certificado_tabla.addClass('hidden'); }}; $.SelectAll = function (elem) { if($(elem).is(':checked')) { $('.check_usuario').prop('checked', true); } else { $('.check_usuario').prop('checked', false); } $.CheckClick();}; $.LoadAlumnoForm = function() { var formulario = $("#usuarioform"); if(formulario.hasClass("open")) { formulario.empty(); formulario.removeClass("open"); } $.ajax({ data: $.RawData("LoadAlumnoForm"), success: function (response) { formulario.html(response); formulario.addClass("open"); }, complete: function () { formulario.find('input').first().focus(); } });};$.LoadDocenteForm = function() { var formulario = $("#docenteform"); if(formulario.hasClass("open")) { formulario.empty(); formulario.removeClass("open"); } $.ajax({ data: $.RawData("LoadDocenteForm"), success: function (response) { formulario.html(response); formulario.addClass("open"); }, complete: function () { formulario.find('input').first().focus(); } });};$.CloseAlumnoForm = function() { var formulario = $("#usuarioform"); if(formulario.hasClass("open")) { formulario.empty(); formulario.removeClass("open"); }};$.CloseDocenteForm = function() { var formulario = $("#docenteform"); if(formulario.hasClass("open")) { formulario.empty(); formulario.removeClass("open"); }};$.SaveUsuario = function() { var form = $('#formAlumno'); var usuario = []; var empty = false; var saveVaccines = false; var isNew = false; var vacForm = $('#vacunasformulario'); if(vacForm.hasClass('open')) { $.each($('#vacunasformulario').find('select[name=vacuna]'), function () { $(this).css("border-color","inherit"); if($(this).val()===""){ $(this).css("border-color","var(--rojo)"); empty = true; } }); $.each($('#vacunasformulario').find('input[name=numero]'), function () { $(this).css("border-color","inherit"); if($(this).val()===""){ $(this).css("border-color","var(--rojo)"); empty = true; } }); $.each($('#vacunasformulario').find('input[name=fecha]'), function () { $(this).css("border-color","inherit"); if($(this).val()===""){ $(this).css("border-color","var(--rojo)"); empty = true; } }); if(!empty) { $.SaveVaccines(); saveVaccines = true; } } $.each(form.serializeArray(), function(i, field) { var input = $('input[name='+field.name+']'); field.value = $.trim(field.value); if(field.value === "" && field.name !== "fechanacimiento") { $('#formAlumno .required').css("border-color", "var(--azul-principal2)"); empty = true; $('#formAlumno .required').each(function(){ $(this).css("border-color","inherit"); if($(this).val() === ""){ $(this).css("border-color", "var(--rojo)"); } }); $('#formAlumno option:selected').each(function() { $(this).css("border-color","inherit"); if ($(this).val() === "") { $(this).css("border-color", "var(--rojo)"); } }); return false; } switch (field.name) { case "idusuario": usuario["idusuario"] = field.value; break; case "nombres": usuario["nombres"] = field.value; break; case "apellidos": usuario["apellidos"] = field.value; break; case "username": usuario["username"] = field.value ? field.value : ''; break; case "rut": usuario["rut"] = field.value ? field.value : ''; break; case "fechanacimiento": usuario["fechanacimiento"] = field.value ? field.value : ''; break; case "carrera": usuario["idcarrera"] = field.value ? field.value : ''; break; case "sede": usuario["idsede"] = field.value ? field.value : ''; break; case "password": usuario["password"] = field.value ? field.value : ''; break; default: console.log("default: " + field.value); break; } }); if(usuario["idusuario"]==="0") isNew = true; if(!empty) { $.ajax({ data: $.RawData('CreateModifyUsuario', { 'IdUsuario': usuario["idusuario"], 'Nombres': usuario["nombres"], 'Apellidos': usuario["apellidos"], 'Username': "", 'Rut': usuario["rut"], 'FechaNacimiento': usuario["fechanacimiento"], 'IdCarrera': usuario["idcarrera"], 'IdSede': usuario["idsede"], 'Password': "", 'IdTipoUsuario': 1 }), success: function (idUsuario) { if (isNew) { $.LoadUsuario(usuario["rut"], "new"); } else if(saveVaccines) { $.LoadUsuario(usuario["rut"], "save"); } else { $.LoadUsuario(usuario["rut"], "edit"); } }, complete: function () { } }); } else { $.UpdateMessageForm('required'); }};$.SaveDocente = function() { var form = $('#formDocente'); var usuario = []; var empty = false; var isNew = false; $.each(form.serializeArray(), function(i, field) { var input = $('input[name='+field.name+']'); field.value = $.trim(field.value); if(field.value === "" && field.name !== "fechanacimiento") { $('#formDocente .required').css("border-color", "var(--azul-principal2)"); empty = true; $('#formDocente .required').each(function(){ $(this).css("border-color","inherit"); if($(this).val() === ""){ $(this).css("border-color", "var(--rojo)"); } }); $('#formDocente option:selected').each(function() { $(this).css("border-color","inherit"); if ($(this).val() === "") { $(this).css("border-color", "var(--rojo)"); } }); return false; } console.log(field); switch (field.name) { case "idusuario": usuario["idusuario"] = field.value; break; case "nombres": usuario["nombres"] = field.value; break; case "apellidos": usuario["apellidos"] = field.value; break; case "username": usuario["username"] = field.value ? field.value : ''; break; case "rut": usuario["rut"] = field.value ? field.value : ''; break; case "fechanacimiento": usuario["fechanacimiento"] = field.value ? field.value : ''; break; case "carrera": usuario["idcarrera"] = field.value ? field.value : ''; break; case "institucion": usuario["idsede"] = field.value ? field.value : ''; break; case "password": usuario["password"] = field.value == '******' ? '' : field.value; break; default: console.log("default: " + field.value); break; } }); if(usuario["idusuario"]==="0") isNew = true; if(!empty) { $.ajax({ data: $.RawData('CreateModifyUsuario', { 'IdUsuario': usuario["idusuario"], 'Nombres': usuario["nombres"], 'Apellidos': usuario["apellidos"], 'Username': usuario["username"], 'Rut': "", 'FechaNacimiento': "", 'IdCarrera': 37, 'IdSede': usuario["idsede"], 'Password': usuario["password"], 'IdTipoUsuario': 2 }), success: function (idUsuario) { $.CloseDocenteForm(); $.LoadDocenteAdmin(); }, complete: function () { } }); } else { $.UpdateMessageForm('required'); }};$.LoadDocenteAdmin = function(){ $.ajax({ data: $.RawData("LoadDocenteAdmin"), success: function (response) { $("#doce_admin").html(response); }, complete: function(){ $('#docentetable').DataTable({ paging: true, "oLanguage": { "sProcessing": "Procesando...", "sLengthMenu": "Mostrar _MENU_ registros", "sSearch": "Filtrar Docente:", "sInfo": "Mostrando _TOTAL_ docentes", "sInfoEmpty": "Mostrando 0 docentes", "sZeroRecords": "No se encontraron resultados", "sInfoFiltered": "(filtrado de un total de _MAX_)", "oPaginate": { "sFirst": "Primero", "sLast": "Ultimo", "sNext": "Siguiente", "sPrevious": "Anterior" }, } }); } });};$.LoadUsuario = function(usuario, action) { var formulario = $("#usuarioform"); if(formulario.hasClass("open")) { formulario.empty(); formulario.removeClass("open"); } $.ajax({ data: $.RawData("LoadUsuario", { 'usuario': usuario }), success: function (response) { formulario.html(response); formulario.addClass("open"); if(action!==""){ $.UpdateMessageForm(action); if (action==="save"||action==="edit") { $('#editvaccines').click(); } } }, complete: function () { formulario.find('input').first().focus(); } });};$.LoadDocente = function(idUsuario) { var formulario = $("#docenteform"); if(formulario.hasClass("open")) { formulario.empty(); formulario.removeClass("open"); } $.ajax({ data: $.RawData("LoadDocente", { 'usuario': idUsuario }), success: function (response) { formulario.html(response); formulario.addClass("open"); }, complete: function () { formulario.find('input').first().focus(); } });};$.EditUsuario = function(idUsuario) {};$.DeleteUsuario = function(idUsuario) { $.ajax({ data: $.RawData('RemoveUsuario', { 'IdUsuario': idUsuario }), success: function () { $('#resultstable tr[data-idusuario="'+idUsuario+'"]').remove(); }, complete: function(){} });};$.DeleteDocente = function(idUsuario) { $.ajax({ data: $.RawData('RemoveUsuario', { 'IdUsuario': idUsuario }), success: function () { $.LoadDocenteAdmin(); }, complete: function(){} });}; $.UpdateMessageForm = function (action) { $.ajax({ data: $.RawData('UserMessage', { 'action': action }), success: function (response) { $('#usermessage').html(response); }, complete: function(){} });}; $.LoadSelectVacuna = function() { $.ajax({ data: $.RawData("LoadSelectSede"), success: function (response) { $("#sedes").html(response); }, complete: function(){} });}; $.LoadVacunaAdmin = function(){ $.ajax({ data: $.RawData("LoadVacunaAdmin"), success: function (response) { $("#vacu_admin").html(response); }, complete: function(){ $('#vacunastable').DataTable({ paging: true, "oLanguage": { "sProcessing": "Procesando...", "sLengthMenu": "Mostrar _MENU_ registros", "sSearch": "Filtrar Vacuna:", "sInfo": "Mostrando _TOTAL_ vacunas", "sInfoEmpty": "Mostrando 0 vacunas", "sZeroRecords": "No se encontraron resultados", "sInfoFiltered": "(filtrado de un total de _MAX_)", "oPaginate": { "sFirst": "Primero", "sLast": "Ultimo", "sNext": "Siguiente", "sPrevious": "Anterior" }, } }); } });}; $.LoadVacunaForm = function() { var formulario = $("#vacunaform"); if(formulario.hasClass("open")) { formulario.empty(); formulario.removeClass("open"); } else { $.ajax({ data: $.RawData("LoadVacunaForm"), success: function (response) { formulario.html(response); formulario.addClass("open"); }, complete: function () { formulario.find('input').first().focus(); } }); }};$.SaveVacuna = function(elem) { var form = $(elem).closest('.formulario'); var vacuna = []; var empty = false; vacuna["idvacuna"] = form.find('input[name=idvacuna]').val(); if(form.find('input[name=vacuna]').val() === "") { form.find('input[name=vacuna]').css("border-color", "red"); empty = true; } else { vacuna["vacuna"] = form.find('input[name=vacuna]').val(); } if(form.find('input[name=folio]').val() === "") { form.find('input[name=folio]').css("border-color", "red"); empty = true; } else { vacuna["folio"] = form.find('input[name=folio]').val(); } console.log(vacuna); if(empty) { } else { if($("#vacunaform").hasClass("open")) $.LoadVacunaForm(); $.ajax({ data: $.RawData('CreateModifyVacuna', { 'IdVacuna': vacuna["idvacuna"], 'Vacuna': vacuna["vacuna"], 'Lote': vacuna["folio"] }), success: function () { $.LoadVacunaAdmin(); }, complete: function(){} }); }};$.DeleteVacuna = function(idVacuna) { $.ajax({ data: $.RawData('RemoveVacuna', { 'IdVacuna': idVacuna }), success: function () { $.LoadVacunaAdmin(); }, complete: function(){} });}; $.AddVaccine = function(idUsuario) { $.ajax({ data: $.RawData('UserVaccine', { 'IdUsuarioVacuna': 0, 'IdVacuna': 0, 'IdUsuario': idUsuario, 'Numero': 0, 'Fecha': '', }), success: function (response) { $.ajax({ data: $.RawData('AddVaccine', { 'IdUsuario': idUsuario, }), success: function (response) { $('#vacunasformulario').append(response); $.UpdateMessageForm("newvac"); }, }); }, complete: function(){} });};$.ShowVaccines = function(idUsuario) { $.LoadUsuario(idUsuario); var checkExist = setInterval(function() { if ($('#editvaccines').length) { $('#editvaccines').click(); clearInterval(checkExist); } }, 100); };$.RemoveVaccine = function(idUsuarioVacuna) { $.ajax({ data: $.RawData('DetachVaccine', { 'IdUsuarioVacuna': idUsuarioVacuna, }), success: function (response) { $("div.vacunarow[data-idusuariovacuna='"+idUsuarioVacuna+"']").remove(); $.UpdateMessageForm("delvac"); }, });};$.EditVaccines = function(elem) { var form = $('#vacunasformulario'); if(form.hasClass('open')) { form.removeClass('open'); $(elem).html('Editar Vacunas <div class="icon small" onclick="" title="Vacunas"><div class="syringe3 right"></div></div>'); } else { form.addClass('open'); $(elem).html('Ocultar Vacunas <div class="icon small" onclick="" title="Ocultar Vacunas"><div class="cancel right"></div></div>'); }};$.SaveVaccines = function () { var vacunas = $('#vacunasformulario').find('div.vacunarow[data-edited=true]'); $.each(vacunas, function () { var vacuna = []; vacuna["idusuariovacuna"] = $(this).attr('data-idusuariovacuna'); vacuna["idvacuna"] = $(this).find('select[name=vacuna]').val(); vacuna["idusuario"] = $('#usuarioform').find('div.formulario').attr('data-idusuario'); vacuna["numero"] = $(this).find('input[name=numero]').val(); vacuna["fecha"] = $(this).find('input[name=fecha]').val(); var ready = true; if (vacuna["idvacuna"]==="") { $(this).find('select[name=vacuna]').css("border-color","red"); ready = false; } if (vacuna["numero"]==="") { $(this).find('input[name=numero]').css("border-color","red"); ready = false; } if (vacuna["fecha"]==="") { $(this).find('input[name=fecha]').css("border-color","red"); ready = false; } if (ready) { $.ajax({ data: $.RawData('UserVaccine', { 'IdUsuarioVacuna': vacuna["idusuariovacuna"], 'IdVacuna': vacuna["idvacuna"], 'IdUsuario': vacuna["idusuario"], 'Numero': vacuna["numero"], 'Fecha': vacuna["fecha"] }), success: function () {}, }); } });}; $.UpdateVaccine = function (elem) { $(elem).closest('div.vacunarow').attr('data-edited', 'true');}; $.GenerarMultiplesCertificados = function() { $(".cargando").addClass("up"); var usuarios = []; var counter = 0; $.each($("input[name='usuario']:checked"), function(){ var idusuario = $(this).attr('data-idusuario'); usuarios.push(idusuario); }); if(usuarios.length <= 5) { var i; for(i=0; i<usuarios.length; i++) { $.GenerarCertificado(usuarios[i]); } $(".cargando").removeClass("up"); } else { $.ajax({ data: $.RawData('GenerarCertificado', { 'usuarios': usuarios, 'multiple': 1 }), success: function (fileURL) { var fileName = 'consolidado.pdf'; if (!window.ActiveXObject) { var save = document.createElement('a'); save.href = fileURL; console.log(fileURL); save.target = '_blank'; save.download = fileName || 'unknown'; var evt = new MouseEvent('click', { 'view': window, 'bubbles': true, 'cancelable': false }); save.dispatchEvent(evt); (window.URL || window.webkitURL).revokeObjectURL(save.href); } }, complete: function () { $(".cargando").removeClass("up"); } }); }}; $.GenerarCertificado = function (idUsuario) { $.ajax({ data: $.RawData('GenerarCertificado', { 'idusuario': idUsuario, 'multiple': 0 }), success: function (fileURL) { var fileName = 'certificado.pdf'; if (!window.ActiveXObject) { var save = document.createElement('a'); save.href = fileURL; console.log(fileURL); save.target = '_blank'; save.download = fileName || 'unknown'; var evt = new MouseEvent('click', { 'view': window, 'bubbles': true, 'cancelable': false }); save.dispatchEvent(evt); (window.URL || window.webkitURL).revokeObjectURL(save.href); } } });}; $.GenerarCertificadoTabla = function() { $(".cargando").addClass("up"); var usuarios = []; var counter = 0; $.each($("input[name='usuario']:checked"), function(){ var idusuario = $(this).attr('data-idusuario'); usuarios.push(idusuario); }); $.ajax({ data: $.RawData('GenerarCertificadoTabla', { 'usuarios': usuarios, 'multiple': 1 }), success: function (fileURL) { var fileName = 'consolidado-tabla.pdf'; if (!window.ActiveXObject) { var save = document.createElement('a'); save.href = fileURL; console.log(fileURL); save.target = '_blank'; save.download = fileName || 'unknown'; var evt = new MouseEvent('click', { 'view': window, 'bubbles': true, 'cancelable': false }); save.dispatchEvent(evt); (window.URL || window.webkitURL).revokeObjectURL(save.href); } }, complete: function () { $(".cargando").removeClass("up"); } });};